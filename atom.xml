<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>singlecell.me</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zhewa.github.io/"/>
  <updated>2019-05-11T19:41:32.262Z</updated>
  <id>https://zhewa.github.io/</id>
  
  <author>
    <name>Zhe Wang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Gene Set Enrichment Analysis (GSEA) and How It Works</title>
    <link href="https://zhewa.github.io/2019/05/11/gsea/"/>
    <id>https://zhewa.github.io/2019/05/11/gsea/</id>
    <published>2019-05-11T13:44:42.000Z</published>
    <updated>2019-05-11T19:41:32.262Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><img src="/2019/05/11/gsea/F1.large.jpg"><a id="more"></a><p><span class="image-caption">Figure 1 from Subramanian A, et al. 2005</span><sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Subramanian A, Tamayo P, Mootha VK, Mukherjee S, Ebert BL, Gillette MA, et al. Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles. Proceedings of the National Academy of Sciences of the United States of America. 2005;102(43):15545-50.">[1]</span></a></sup> </p><p>Given a ranked gene list $L$ containing $N$ genes, ordered according to their differential expression between the classes. Given an <em>a priori</em> defined set of genes $S$ (e.g., genes sharing the same GO category) containing $N_s$ genes, the goal of GSEA is to determine whether the members of $S$ are randomly distributed throughout $L$ or primarily found at the top or bottom<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Subramanian A, Tamayo P, Mootha VK, Mukherjee S, Ebert BL, Gillette MA, et al. Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles. Proceedings of the National Academy of Sciences of the United States of America. 2005;102(43):15545-50.">[1]</span></a></sup>. We expect the latter if the gene set is related to the phenotypic distinction between the classes. In short, <strong>GSEA determines if a set of genes is differentially expressed between two conditions</strong>.</p><h1><span id="step-1-calculation-of-an-enrichment-score">Step 1: Calculation of an Enrichment Score.</span></h1><h2><span id="running-sum-statistic">Running-sum statistic</span></h2><p>The enrichment score (ES) is calculated by walking down the list $L$, increasing a running-sum statistic when we encounter a gene in $S$ and decreasing it when we encounter genes not in $S$. The increment or decrement of a gene $X_i$ is calculated based on the following:</p><script type="math/tex; mode=display">\begin{equation}X_i=\begin{cases}\frac{\left|r_i\right|^p}{\sum_{i \in S}^{} \left|r_i\right|^p},  & i \in S \\[2ex]-\frac{1}{N - N_s}, & i \notin S\end{cases}\end{equation}\label{eq1}</script><p>where $r_i$ is the correlation of the gene $i$ with the phenotype. This is the signal-to-noise ratio if using default GSEA ranking metric for input data matrix with gene expression values. If a pre-ranked gene list is provided, the values in the pre-ranked list is used instead. $p$ is the enrichment weighting exponent. Subramanian A, et al. found that $p = 1$ (weighting by the correlation) is a very reasonable choice that allows significant gene sets with less than perfect coherence, i.e., only a subset of genes in the set are coordinately expressed, to score well. If one is interested in penalizing sets for lack of coherence or to discover sets with any type of nonrandom distribution of tags, a value $p &lt; 1$ might be appropriate. On the other hand, if one uses sets with large number of genes and only a small subset of those is expected to be coherent, then one could consider using $p &gt; 1$. If $p=0$, the enrichment score (ES) is a standard Kolmogorov-Smirnov statistic.</p><p>The running-sum statistic $D_g$ up to $n$th gene $g$ is calculated by taking the sum of $X$ from all genes in $L$ including and before $g$:</p><script type="math/tex; mode=display">\begin{equation}D_g = \sum_{i=0}^{n}{X_i}\end{equation}\label{eq2}</script><h2><span id="enrichment-score">Enrichment score</span></h2><p>After calculating the running-sum statistics for all genes in $L$, ES is the maximum deviation from zero encountered in this random walk. It corresponds to a weighted Kolmogorov-Smirnov-like statistic.</p><script type="math/tex; mode=display">\begin{equation}\text{ES}=\begin{cases}\sup_i \sum{X_i},  & X_i \geqslant 0 \\[2ex]\inf_i \sum{X_i},  & X_i < 0\end{cases}\end{equation}\label{eq3}</script><h1><span id="step-2-estimation-of-significance-level-of-es">Step 2: Estimation of Significance Level of ES.</span></h1><h1><span id="step-3-adjustment-for-multiple-hypothesis-testing">Step 3: Adjustment for Multiple Hypothesis Testing.</span></h1><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Subramanian A, Tamayo P, Mootha VK, Mukherjee S, Ebert BL, Gillette MA, et al. Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles. Proceedings of the National Academy of Sciences of the United States of America. 2005;102(43):15545-50.<a href="#fnref:1" rev="footnote"> ↩</a></span></li></ol></div></div>]]></content>
    
    <summary type="html">
    
      &lt;img src=&quot;/2019/05/11/gsea/F1.large.jpg&quot;&gt;
    
    </summary>
    
    
      <category term="GSEA" scheme="https://zhewa.github.io/tags/GSEA/"/>
    
  </entry>
  
  <entry>
    <title>scruff, a new R/Bioconductor package for preprocessing scRNA-seq data</title>
    <link href="https://zhewa.github.io/2019/05/05/scruff/"/>
    <id>https://zhewa.github.io/2019/05/05/scruff/</id>
    <published>2019-05-05T16:13:45.000Z</published>
    <updated>2019-05-07T02:12:32.788Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><img src="https://raw.githubusercontent.com/zhewa/zhewa.github.io/source/hexo/source/_posts/scruff/scruff_figure1.png" width="500"><a id="more"></a><p><a href="https://doi.org/10.1186/s12859-019-2797-2" target="_blank" rel="noopener">scruff</a>, a new <a href="http://bioconductor.org/packages/scruff/" target="_blank" rel="noopener">R/Bioconductor</a> package published on <a href="https://bmcbioinformatics.biomedcentral.com/" target="_blank" rel="noopener">BMC Bioinformatics</a>, provides a whole new experience in scRNA-seq data preprocessing. For details, visit <a href="https://doi.org/10.1186/s12859-019-2797-2" target="_blank" rel="noopener">https://doi.org/10.1186/s12859-019-2797-2</a>.</p>]]></content>
    
    <summary type="html">
    
      &lt;img src=&quot;https://raw.githubusercontent.com/zhewa/zhewa.github.io/source/hexo/source/_posts/scruff/scruff_figure1.png&quot; width=&quot;500&quot;&gt;
    
    </summary>
    
    
      <category term="scRNA-seq" scheme="https://zhewa.github.io/tags/scRNA-seq/"/>
    
      <category term="pipeline" scheme="https://zhewa.github.io/tags/pipeline/"/>
    
      <category term="UMI" scheme="https://zhewa.github.io/tags/UMI/"/>
    
      <category term="CEL-Seq" scheme="https://zhewa.github.io/tags/CEL-Seq/"/>
    
  </entry>
  
  <entry>
    <title>An R script to process Cell Ranger output files</title>
    <link href="https://zhewa.github.io/2019/05/01/processCellRangerOutputs/"/>
    <id>https://zhewa.github.io/2019/05/01/processCellRangerOutputs/</id>
    <published>2019-05-01T14:29:03.000Z</published>
    <updated>2019-05-05T16:27:08.542Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>First install the required packages <code>data.table</code>, <code>Matrix</code>, and <code>SingleCellExperiment</code>.<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!requireNamespace(<span class="string">"data.table"</span>, quietly = <span class="literal">TRUE</span>)) &#123;</span><br><span class="line">    install.packages(<span class="string">"data.table"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!requireNamespace(<span class="string">"Matrix"</span>, quietly = <span class="literal">TRUE</span>)) &#123;</span><br><span class="line">    install.packages(<span class="string">"Matrix"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!requireNamespace(<span class="string">"SingleCellExperiment"</span>, quietly = <span class="literal">TRUE</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!requireNamespace(<span class="string">"BiocManager"</span>, quietly = <span class="literal">TRUE</span>)) &#123;</span><br><span class="line">        install.packages(<span class="string">"BiocManager"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    BiocManager::install(<span class="string">"SingleCellExperiment"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>The definition of function <code>processCellRangerOutput</code> is shown below. This function reads the count files (in sparse matrix format), the cell barcodes, and the feature annotations for each sample, writes each of the count matrices as a tab separated text file, then combines the count matrices as one for all samples, and finally writes it as a tab separated text file as well as a <code>SingleCellExperiment</code> object to specified path.</p><p>Note that this process requires a lot of memory depending on the size of the data. It might fail if the free memory on the computer is not enough for allocation or the data is too large to fit in the RAM.<br><figure class="highlight r"><figcaption><span>processCellRangerOutput.R</span><a href="https://github.com/zhewa/usefulscripts/blob/master/processCellRangerOutput.R" target="_blank" rel="noopener">link</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#' @title Process Cell Ranger output</span></span><br><span class="line"><span class="comment">#' @description Read the filtered matrices for all samples from Cell Ranger</span></span><br><span class="line"><span class="comment">#'  output. Combine them into one big expression matrix and write it to</span></span><br><span class="line"><span class="comment">#'  \code&#123;outDir&#125;. A \link[SingleCellExperiment]&#123;SingleCellExperiment&#125; object is</span></span><br><span class="line"><span class="comment">#'  also saved as a `.RDS` file.</span></span><br><span class="line"><span class="comment">#' @param cellRangerDir The root path where Cell Ranger was run. This folder</span></span><br><span class="line"><span class="comment">#'  should contain sample specific folders.</span></span><br><span class="line"><span class="comment">#' @param samples A vector of sample names. Must be the same as the folder names</span></span><br><span class="line"><span class="comment">#'  of the samples.</span></span><br><span class="line"><span class="comment">#' @param project The project name. Can be any string. It is</span></span><br><span class="line"><span class="comment">#'  added to the filenames of the combined count matrix and the</span></span><br><span class="line"><span class="comment">#'  \code&#123;SingleCellExperiment&#125; object.</span></span><br><span class="line"><span class="comment">#' @param writeIndivisualSampleCounts Boolean. Whether to write sample specific</span></span><br><span class="line"><span class="comment">#'  count matrices to output files or not. Default \code&#123;TRUE&#125;.</span></span><br><span class="line"><span class="comment">#' @param writeAllSampleCounts Boolean. Whether to write combined count matrix</span></span><br><span class="line"><span class="comment">#'  to output file or not. Default \code&#123;TRUE&#125;.</span></span><br><span class="line"><span class="comment">#' @param writeSCE Boolean. Whether to save the \code&#123;SingleCellExperiment&#125;</span></span><br><span class="line"><span class="comment">#'  object containing the combined count matrix to output file or not. Default</span></span><br><span class="line"><span class="comment">#'  \code&#123;TRUE&#125;.</span></span><br><span class="line"><span class="comment">#' @param sep The field separator string. Values within each row are separated</span></span><br><span class="line"><span class="comment">#'  by this string when writing output files.</span></span><br><span class="line"><span class="comment">#' @param outDir The path to output location. Default to current working</span></span><br><span class="line"><span class="comment">#'  directory.</span></span><br><span class="line"><span class="comment">#' @param outPrefix Prefix to output files. Default to current date.</span></span><br><span class="line"><span class="comment">#' @param overwrite Boolean. Whether to overwrite output files or not. Default</span></span><br><span class="line"><span class="comment">#'  \code&#123;FALSE&#125;.</span></span><br><span class="line"><span class="comment">#' @param cellRangerOuts The intermidiate path to filtered feature count files</span></span><br><span class="line"><span class="comment">#'  saved in sparce matrix format. Reference genome names might need to be</span></span><br><span class="line"><span class="comment">#'  appended if reads were mapped to multiple genomes when running Cell Ranger</span></span><br><span class="line"><span class="comment">#'  pipeline. Default \code&#123;"outs/filtered_feature_bc_matrix/"&#125;.</span></span><br><span class="line"><span class="comment">#' @param gzipped Boolean. Whether the Cell Ranger output files were gzip</span></span><br><span class="line"><span class="comment">#'  compressed or not. This is true subsequent to Cell Ranger 3.0. Default</span></span><br><span class="line"><span class="comment">#'  \code&#123;TRUE&#125;.</span></span><br><span class="line"><span class="comment">#' @return A \code&#123;SingleCellExperiment&#125; object containing the combined count</span></span><br><span class="line"><span class="comment">#'  matrix, the feature annotations, and the cell annotation.</span></span><br><span class="line">processCellRangerOutput &lt;- <span class="keyword">function</span>(</span><br><span class="line">    cellRangerDir,</span><br><span class="line">    samples,</span><br><span class="line">    project = strtrim(paste0(samples, collapse = <span class="string">""</span>), <span class="number">5</span>),</span><br><span class="line">    writeIndivisualSampleCounts = <span class="literal">TRUE</span>,</span><br><span class="line">    writeAllSampleCounts = <span class="literal">TRUE</span>,</span><br><span class="line">    writeSCE = <span class="literal">TRUE</span>,</span><br><span class="line">    sep = <span class="string">"\t"</span>,</span><br><span class="line">    outDir = <span class="string">"."</span>,</span><br><span class="line">    outPrefix = format(Sys.time(), <span class="string">"%Y%m%d"</span>),</span><br><span class="line">    overwrite = <span class="literal">FALSE</span>,</span><br><span class="line">    cellRangerOuts = <span class="string">"outs/filtered_feature_bc_matrix/"</span>,</span><br><span class="line">    gzipped = <span class="literal">TRUE</span>) &#123;</span><br><span class="line"></span><br><span class="line">    fileNames &lt;- c(matrix = <span class="string">"matrix.mtx"</span>,</span><br><span class="line">        features = <span class="string">"features.tsv"</span>,</span><br><span class="line">        barcodes = <span class="string">"barcodes.tsv"</span>)</span><br><span class="line">    <span class="keyword">if</span> (isTRUE(gzipped)) &#123;</span><br><span class="line">        fileNames &lt;- vapply(fileNames,</span><br><span class="line">            FUN = <span class="keyword">function</span>(i) &#123;</span><br><span class="line">                paste0(i, <span class="string">".gz"</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            FUN.VALUE = character(<span class="number">1</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res &lt;- vector(<span class="string">"list"</span>, length = length(samples))</span><br><span class="line">    coldata &lt;- vector(<span class="string">"list"</span>, length = length(samples))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> seq_along(samples)) &#123;</span><br><span class="line">        mm &lt;- Matrix::readMM(gzfile(file.path(cellRangerDir,</span><br><span class="line">            samples[i], cellRangerOuts, fileNames[[<span class="string">"matrix"</span>]])))</span><br><span class="line"></span><br><span class="line">        fe &lt;- read.table(gzfile(file.path(cellRangerDir,</span><br><span class="line">            samples[i], cellRangerOuts, fileNames[[<span class="string">"features"</span>]])), sep = <span class="string">"\t"</span>)</span><br><span class="line"></span><br><span class="line">        bc &lt;- read.table(gzfile(file.path(cellRangerDir,</span><br><span class="line">            samples[i], cellRangerOuts, fileNames[[<span class="string">"barcodes"</span>]])), sep = <span class="string">"\t"</span>)</span><br><span class="line">        coldata[[i]] &lt;- rep(samples[i], nrow(bc))</span><br><span class="line"></span><br><span class="line">        ma &lt;- as.matrix(mm)</span><br><span class="line">        colnames(ma) &lt;- paste(bc[[<span class="number">1</span>]], samples[i], sep = <span class="string">"_"</span>)</span><br><span class="line">        rownames(ma) &lt;- fe[[<span class="number">1</span>]]</span><br><span class="line">        res[[i]] &lt;- ma</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isTRUE(writeIndivisualSampleCounts)) &#123;</span><br><span class="line">            fn &lt;- file.path(outDir,</span><br><span class="line">                paste0(outPrefix, <span class="string">"_"</span>, samples[i], <span class="string">".txt"</span>))</span><br><span class="line">            <span class="keyword">if</span> (isFALSE(overwrite) &amp; file.exists(fn)) &#123;</span><br><span class="line">                <span class="keyword">warning</span>(<span class="string">"File already exists! Skip writting file "</span>, fn)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                data.table::fwrite(ma,</span><br><span class="line">                    file = fn,</span><br><span class="line">                    sep = sep,</span><br><span class="line">                    row.names = <span class="literal">TRUE</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    expr &lt;- do.call(cbind, res)</span><br><span class="line">    exprdt &lt;- data.table::as.data.table(expr, keep.rownames = <span class="literal">TRUE</span>)</span><br><span class="line">    colnames(exprdt)[<span class="number">1</span>] &lt;- <span class="string">"geneID"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isTRUE(writeAllSampleCounts)) &#123;</span><br><span class="line">        fn &lt;- file.path(outDir,</span><br><span class="line">            paste0(outPrefix, <span class="string">"_"</span>, project, <span class="string">"_allcounts.txt"</span>))</span><br><span class="line">        <span class="keyword">if</span> (isFALSE(overwrite) &amp; file.exists(fn)) &#123;</span><br><span class="line">            <span class="keyword">warning</span>(<span class="string">"File already exists! Skip writting file "</span>, fn)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            data.table::fwrite(exprdt,</span><br><span class="line">                file = fn,</span><br><span class="line">                sep = sep,</span><br><span class="line">                row.names = <span class="literal">TRUE</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sce &lt;- SingleCellExperiment::SingleCellExperiment(</span><br><span class="line">        assays = list(counts = expr))</span><br><span class="line">    SummarizedExperiment::rowData(sce) &lt;- fe</span><br><span class="line">    colnames(SummarizedExperiment::rowData(sce)) &lt;- c(<span class="string">"geneID"</span>,</span><br><span class="line">        <span class="string">"genename"</span>, <span class="string">"genebiotype"</span>)</span><br><span class="line">    coldata &lt;- unlist(coldata)</span><br><span class="line">    SummarizedExperiment::colData(sce)[<span class="string">"sample"</span>] &lt;- data.frame(sample = coldata)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isTRUE(writeSCE)) &#123;</span><br><span class="line">        fn &lt;- file.path(outDir,</span><br><span class="line">            paste0(outPrefix, <span class="string">"_"</span>, project, <span class="string">"_allcounts_sce.RDS"</span>))</span><br><span class="line">        <span class="keyword">if</span> (isFALSE(overwrite) &amp; file.exists(fn)) &#123;</span><br><span class="line">            <span class="keyword">warning</span>(<span class="string">"File already exists! Skip writting file "</span>, fn)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            saveRDS(sce, file = fn)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>(sce)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;First install the required packages &lt;code&gt;data.table&lt;/code&gt;, &lt;code&gt;Matrix&lt;/code&gt;, and &lt;code&gt;SingleCellExperiment&lt;/code&gt;.&lt;br&gt;&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!requireNamespace(&lt;span class=&quot;string&quot;&gt;&quot;data.table&quot;&lt;/span&gt;, quietly = &lt;span class=&quot;literal&quot;&gt;TRUE&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    install.packages(&lt;span class=&quot;string&quot;&gt;&quot;data.table&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!requireNamespace(&lt;span class=&quot;string&quot;&gt;&quot;Matrix&quot;&lt;/span&gt;, quietly = &lt;span class=&quot;literal&quot;&gt;TRUE&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    install.packages(&lt;span class=&quot;string&quot;&gt;&quot;Matrix&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!requireNamespace(&lt;span class=&quot;string&quot;&gt;&quot;SingleCellExperiment&quot;&lt;/span&gt;, quietly = &lt;span class=&quot;literal&quot;&gt;TRUE&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!requireNamespace(&lt;span class=&quot;string&quot;&gt;&quot;BiocManager&quot;&lt;/span&gt;, quietly = &lt;span class=&quot;literal&quot;&gt;TRUE&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        install.packages(&lt;span class=&quot;string&quot;&gt;&quot;BiocManager&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    BiocManager::install(&lt;span class=&quot;string&quot;&gt;&quot;SingleCellExperiment&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Single Cell" scheme="https://zhewa.github.io/tags/Single-Cell/"/>
    
      <category term="Script" scheme="https://zhewa.github.io/tags/Script/"/>
    
      <category term="Cell Ranger" scheme="https://zhewa.github.io/tags/Cell-Ranger/"/>
    
      <category term="R" scheme="https://zhewa.github.io/tags/R/"/>
    
  </entry>
  
  <entry>
    <title>The Ethical Issue of Pre-Publication Single Blind Peer Review</title>
    <link href="https://zhewa.github.io/2019/04/22/peerreviewethics/"/>
    <id>https://zhewa.github.io/2019/04/22/peerreviewethics/</id>
    <published>2019-04-23T00:26:47.000Z</published>
    <updated>2019-05-05T16:26:53.249Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><img src="/2019/04/22/peerreviewethics/PeerReview1.jpeg"><a id="more"></a><p>Cartoon source: <a href="http://www.entrelibros.co/app/webroot/blog/wp-content/uploads/2016/11/PeerReview3.jpeg" target="_blank" rel="noopener">http://www.entrelibros.co/app/webroot/blog/wp-content/uploads/2016/11/PeerReview3.jpeg</a></p><p>Peer review is the bedrock of modern scientific publication. A scientific investigation is not fit for publication unless a group of experts signals the go-ahead. In the middle of the 17th century, Henry Oldenburg, the editor of Philosophical Transactions at the Royal Society of London, pioneered the practice that a submitted paper be “first reviewed by some members” of the society, and this is the first record of an editorial pre-publication peer review<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Steinzor R, Wagner W. Rescuing science from politics : regulation and the distortion of scientific research. Cambridge: Cambridge University Press; 2006.">[1]</span></a></sup><sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="On Being a Scientist: A Guide to Responsible Conduct in Research: Third Edition. Washington (DC)2009.">[2]</span></a></sup>. The practice was not popular in scientific publishing until the middle of the 20th century<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Steinzor R, Wagner W. Rescuing science from politics : regulation and the distortion of scientific research. Cambridge: Cambridge University Press; 2006.">[1]</span></a></sup>. Today, pre-publication peer review has become a critical part of the publication process. Only after peer review can a work be considered part of the scientific literature, and only peer-reviewed publication will be recognized during job hiring and evaluation. Each year, more than 1.3 million papers are published in peer reviewed journals<sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Bjork BC, Roos A, Lauri M. Scientific journal publishing: yearly volume and open access availability. Inform Res. 2009;14(1).">[3]</span></a></sup>. There are generally three types of pre-publication peer review:</p><ul><li>Single blind review. Reviewers know the identity of the authors but the authors do not know who the reviewers are.</li><li>Double blind review. Both the reviewers and the authors are anonymous.</li><li>Open review. Both the reviewers and the authors are known to each other.</li></ul><p>Single blind review is prevalent in today’s pre-publication peer review. Most biomedical journals, including Nature, Cell, Science and most Wiley or Elsevier archived journals, support single blind review. A 2015 survey by Publishing Research Consortium further confirmed this by reporting that 84% of respondents had experienced single blind review<sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Ware M MM. Peer review in scholarly journals 2016](http://publishingresearchconsortium.com/index.php/prc-documents/prc-research-projects/36-peer-review-full-prc-report-final/file)">[4]</span></a></sup>. However, scientific journals should reduce the use of single blind review and encourage the use of alternative peer review methods because single blind review is more susceptible to bias, discrimination, and conflicts of interest.</p><p>Single blind review poses a great risk of bias due to asymmetrical disclosure of information. The reviewers have an advantage of choosing preferable studies to review while the authors do not know who will review their submitted manuscript. The information imbalance between the authors and the reviewers affects the decision of the reviewers the moment they started reading the first page of the manuscript. A part of the first impression a reviewer has toward a submitted manuscript may be based on the gender, race, country, affiliation and reputation of the authors. It is morally controversial how this preconception, sometimes subconscious, often stereotypes individuals with labels, and subsequently hijacks the course of peer review.</p><p>One of the forms gender discrimination takes in academia is that female authors are less likely to get their manuscripts published in single-blind reviewed journals. Knobloch-Westerwick et al.<sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Knobloch-Westerwick S, Glynn CJ, Huge M. The Matilda Effect in Science Communication: An Experiment on Gender Bias in Publication Quality Perceptions and Collaboration Interest. Sci Commun. 2013;35(5):603-25.">[5]</span></a></sup> conducted experiments on 243 young scholars and found Matilda effect in the journal of Science Communication. Matilda effect is a bias against acknowledging the achievement of female scientists, whose work is often overlooked or mis-attributed to their male colleagues. In the paper, the authors found that publications from male first authors were believed to have greater scientific merit than papers from female first authors, particularly in male-dominated fields. The sex of the respondents did not influence the pattern. In another study, Budden et al.<sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Budden AE, Tregenza T, Aarssen LW, Koricheva J, Leimu R, Lortie CJ. Double-blind review favours increased representation of female authors. Trends in Ecology & Evolution. 2008;23(1):4-6.">[6]</span></a></sup> analyzed the published papers in the journal Behavioral Ecology before and after it switched from single blind to double blind review in 2001. An increase in the number of female first-authored papers were found after the change. These findings suggest that the gender of the author is an associated factor in deciding whether a paper will be accepted in single blind peer review.</p><p>Additionally, the affiliation of the authors affects the outcome of the single blind review process. A paper from a prestigious institution is more likely to be accepted compared to a paper from a less well-known one in single blind review. Peters and Ceci<sup id="fnref:7"><a href="#fn:7" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Peters DP, Ceci SJ. Peer-Review Practices of Psychological Journals - the Fate of Accepted, Published Articles, Submitted Again. Behav Brain Sci. 1982;5(2):187-95.">[7]</span></a></sup> conducted experiment on the reproducibility of single blind peer review results. Twelve “prestigious” papers already accepted in the 12 top psychology journals were randomly re-submitted after changing the institutional affiliations of the authors to fictitious ones. Three were identified by the reviewers as previously published. In the remaining 9 manuscripts that managed to slip through, 8 were rejected, often citing serious methodological flaws. It is amazingly striking how reviewers based their assessment and comments on the author affiliation and not the actual texts.</p><p>I think how much impact the reputation of the authors has in the decision making of single blind review is indisputable. If an author of the manuscript is well-known in the scientific community, the reviewers are more likely to accept the manuscript in a single-blind-review setting. In a recent study, Okike et al.<sup id="fnref:8"><a href="#fn:8" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Okike K, Hug KT, Kocher MS, Leopold SS. Single-blind vs Double-blind Peer Review in the Setting of Author Prestige. Jama. 2016;316(12):1315-6.">[8]</span></a></sup> found that single blind reviewers were significantly more favorable toward papers written by authors with high prestige or reputation in the field. Even if distinguished authors are more likely to come up with good work like they always do, this does not justify the unfair preference. Each scientific work should be viewed on a case-by-case basis. Showing predisposition based on previous works damages the impartiality of the review process. Favoring work from well-respected authors might lead to acceptance of less significant or even methodologically flawed papers. This is irresponsible to the academia and to the authors themselves.</p><p>One of the implied rules in single blind review is that the reviewers have to be immune to conflicts of interest. The fulfillment of this rule heavily relies on the responsibility of the reviewers. By referring to the reviewers, the editor holds good faith that the reviewers will honor the rule. While it is noble to trust the objectivity and impartiality of the reviewers, there does not exist a supervisory mechanism to prevent them from steering the course of action to where they want it to be. It is perfectly possible that reviewers agree to review their competitor’s manuscript and later dishonorably reject it even though it is in good quality. Additionally, disrespectful reviewers can use the unpublished results in the manuscript as resources for their own research interests or violate the confidentiality by dispersing the manuscript to numerous colleagues. For double blind review, the reviewers do not know the identity of the authors. This makes them unable to selectively reject certain papers based on conflicts of interest. For open review, the authors have the option to switch reviewers if they sense potential conflicts of interest.</p><p>One moral principle these biases violate is justice. From the perspective of principlism, it is socially valued that the distribution of benefits is just. Here, the opportunity to publish a paper is clearly a benefit to the author. The distribution of the benefits according to the author information instead of the actual merit of the manuscript is a strong violation of social justice. From a utilitarian point of view, no utility is achieved in this wrongdoing. The biases do not improve the well-being of humans as a whole. No reports were published showing having these biases leads to more scientific knowledge. In short, the ends do not justify the means.</p><p>Alternative review methods have been attracting authors and journal editors in recent years. Open review is the most transparent way of doing peer review, but it received cold disfavor from the authors. Between June 1st and September 30th of 2006, Nature experimented with open peer review by having submitted manuscripts that passed editors’ initial selection to be hosted on an open server on the internet for public comment. Only 5% of authors opted in this option. At that time, open peer review was not widely popular, either among authors or by scientists invited to comment as there was a marked reluctance among researchers to offer open comments. For double blind review, in a 2009 international and cross-disciplinary survey of 4,037 researchers, 76% of respondents agreed that double blind peer review is effective, while open and single blind peer reviews were considered effective by 20% and 45% respondents, respectively<sup id="fnref:9"><a href="#fn:9" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Mulligan A, Hall L, Raphael E. Peer review in a changing world: An international study measuring the attitudes of researchers. J Am Soc Inf Sci Tec. 2013;64(1):132-61.">[9]</span></a></sup>. This is consistent with a more recent report from the Publishing Research Consortium<sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Ware M MM. Peer review in scholarly journals 2016](http://publishingresearchconsortium.com/index.php/prc-documents/prc-research-projects/36-peer-review-full-prc-report-final/file)">[4]</span></a></sup> where 56% of 3040 respondents prefer double blind review. Started in March 2015, Nature and the monthly Nature research journals offered an option to authors to have their names and affiliations withheld from the reviewers<sup id="fnref:10"><a href="#fn:10" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Nature journals offer double-blind review. Nature. 2015;518(7539):274-.">[10]</span></a></sup>. These reports show that double blind review might be more favorable compared to single blind review in today’s scientific community.</p><p>One counterclaim to the idea of double blind review is that even though the author information is omitted, the reviewers can still infer from the content of the manuscript who the authors are. In this case, double blind review would be unnecessary and pointless. This is a weak rebuttal because countless manuscripts get submitted every day and the probability a reviewer reviews the paper from a close acquaintance who at the same time submitted a manuscript is infinitesimal. Even though in some fields with a small academic community this is more likely to happen, the best a reviewer can do is to guess who the authors might be. In reality, the identity of the authors is still protected. This is important in preserving the objectivity of peer review.</p><p>One might say that double blind review costs more or takes more time compared with single blind review and this makes them impractical in real life. This is simply not true. The only extra step for a manuscript to undergo double blind review is leaving out any information that might reveal author identity. This usually includes removing or mosaicking the author names, affiliations, and acknowledgements in the paper and can be done in a minute. Other than that, every step is the same as single blind review.</p><p>Contemporary peer review process is an empirically established convention rather than a scientifically validated principle<sup id="fnref:11"><a href="#fn:11" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Horrobin DF. Something rotten at the core of science? Trends Pharmacol Sci. 2001;22(2):51-2.">[11]</span></a></sup>. This makes us wonder why authors have to be in an informatively disadvantaged position compared to the reviewers especially in single blind review. Science is the organization of knowledge about the universe. As the gatekeeper of scientific literature, peer review process is intolerable to be tampered with. Its reliability, sustainability, fairness and impartiality cannot be over-emphasized. In the case of single blind review, it is simply not suited for the job.</p><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Steinzor R, Wagner W. Rescuing science from politics : regulation and the distortion of scientific research. Cambridge: Cambridge University Press; 2006.<a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">On Being a Scientist: A Guide to Responsible Conduct in Research: Third Edition. Washington (DC)2009.<a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Bjork BC, Roos A, Lauri M. Scientific journal publishing: yearly volume and open access availability. Inform Res. 2009;14(1).<a href="#fnref:3" rev="footnote"> ↩</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a href="http://publishingresearchconsortium.com/index.php/prc-documents/prc-research-projects/36-peer-review-full-prc-report-final/file" target="_blank" rel="noopener">Ware M MM. Peer review in scholarly journals 2016</a><a href="#fnref:4" rev="footnote"> ↩</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Knobloch-Westerwick S, Glynn CJ, Huge M. The Matilda Effect in Science Communication: An Experiment on Gender Bias in Publication Quality Perceptions and Collaboration Interest. Sci Commun. 2013;35(5):603-25.<a href="#fnref:5" rev="footnote"> ↩</a></span></li><li id="fn:6"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">6.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Budden AE, Tregenza T, Aarssen LW, Koricheva J, Leimu R, Lortie CJ. Double-blind review favours increased representation of female authors. Trends in Ecology &amp; Evolution. 2008;23(1):4-6.<a href="#fnref:6" rev="footnote"> ↩</a></span></li><li id="fn:7"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">7.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Peters DP, Ceci SJ. Peer-Review Practices of Psychological Journals - the Fate of Accepted, Published Articles, Submitted Again. Behav Brain Sci. 1982;5(2):187-95.<a href="#fnref:7" rev="footnote"> ↩</a></span></li><li id="fn:8"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">8.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Okike K, Hug KT, Kocher MS, Leopold SS. Single-blind vs Double-blind Peer Review in the Setting of Author Prestige. Jama. 2016;316(12):1315-6.<a href="#fnref:8" rev="footnote"> ↩</a></span></li><li id="fn:9"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">9.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Mulligan A, Hall L, Raphael E. Peer review in a changing world: An international study measuring the attitudes of researchers. J Am Soc Inf Sci Tec. 2013;64(1):132-61.<a href="#fnref:9" rev="footnote"> ↩</a></span></li><li id="fn:10"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">10.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Nature journals offer double-blind review. Nature. 2015;518(7539):274-.<a href="#fnref:10" rev="footnote"> ↩</a></span></li><li id="fn:11"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">11.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Horrobin DF. Something rotten at the core of science? Trends Pharmacol Sci. 2001;22(2):51-2.<a href="#fnref:11" rev="footnote"> ↩</a></span></li></ol></div></div>]]></content>
    
    <summary type="html">
    
      &lt;img src=&quot;/2019/04/22/peerreviewethics/PeerReview1.jpeg&quot;&gt;
    
    </summary>
    
    
      <category term="Ethics" scheme="https://zhewa.github.io/tags/Ethics/"/>
    
  </entry>
  
</feed>
